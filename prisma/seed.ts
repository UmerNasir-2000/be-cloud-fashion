import { Prisma, PrismaClient } from '@prisma/client';
import axios from 'axios';
const prisma = new PrismaClient();

function getRandomProductSize() {
  let sizes = [
    {
      size: 'S',
      label: 'Small',
      available: Math.random() >= 0.5,
    },
    {
      size: 'M',
      label: 'Medium',
      available: Math.random() >= 0.5,
    },
    {
      size: 'L',
      label: 'Large',
      available: Math.random() >= 0.5,
    },
    {
      size: 'XL',
      label: 'Extra Large',
      available: Math.random() >= 0.5,
    },
  ];

  const randomIndex = Math.floor(Math.random() * sizes.length);

  if (Math.random() >= 0.5) sizes = sizes.splice(randomIndex, 1);
  else sizes.pop();

  return sizes;
}

async function handleVendor(
  vendorTitle: string,
  featuredImage: string,
): Promise<string> {
  let vendor = await prisma.vendor.findUnique({
    where: { title: vendorTitle.trim() },
  });

  if (vendor) return vendor.id;

  vendor = await prisma.vendor.create({
    data: {
      title: vendorTitle.trim(),
      featuredImage,
      slug: vendorTitle.trim().toLowerCase().replace(/\s+/g, '-'),
    },
  });

  return vendor.id;
}

async function main() {
  const slugs = [
    'ajjm-01',
    'ajjm-02',
    'ajjm-03',
    'ajjm-04',
    'ajjm-05',
    'ajjm-06',
    'ajjm-07',
    'ajjm-08',
    'ajjm-09',
    'ajjm-10',
    'ajjm-11',
    'ajjm-12',
    'ajjm-13',
    'ajjm-14',
    'ajjm-15',
    'ajhj-01',
    'ajhj-02',
    'ajhj-03',
    'ajhj-04',
    'ajhj-05',
    'ajhj-06',
    'ajhj-07',
    'ajhj-08',
    'ajhj-09',
    'ajhj-10',
    'ajhj-11',
    'ajhj-12',
    'ajhj-13',
    'ajhj-14',
    'ajhj-15',
    'ajhj-16',
    'ajhj-17',
    'ajhj-18',
    'ajhj-19',
    'ajhj-20',
    'ajhj-21',
    'ajhj-22',
    'ajhj-23',
    'ajhj-24',
    'ajhj-25',
    'ajjd-01',
    'ajjd-02',
    'ajjd-03',
    'ajjd-04',
    'ajjd-05',
    'ajjd-06',
    'ajjd-07',
    'ajjd-08',
    'ajjd-09',
    'ajjd-10',
    'ajjd-11',
    'ajjd-12',
    'ajjd-13',
    'ajjd-14',
    'ajjd-15',
    'ajmq-01',
    'ajmq-02',
    'ajmq-03',
    'ajmq-04',
    'ajmq-05',
    'ajmq-06',
    'ajmq-07',
    'ajmq-08',
    'ajmq-09',
    'ajmq-10',
    'ajmq-11',
    'ajmq-12',
    'ajkm-01',
    'ajkm-02',
    'ajkm-03',
    'ajkm-04',
    'ajkm-05',
    'ajkm-06',
    'ajkm-07',
    'ajkm-08',
    'ajkm-09',
    'ajkm-10',
    'ajkm-11',
    'ajkm-12',
    'ajkm-13',
    'ajkm-14',
    'ajkm-15',
    'ajkm-16',
    'ajkm-17',
    'ajkm-18',
    'ajkm-19',
    'ajkm-20',
    'ajai-01',
    'ajai-02',
    'ajai-03',
    'ajai-04',
    'ajai-05',
    'ajai-06',
    'ajai-07',
    'ajai-08',
    'ajai-09',
    'ajai-10',
    'ajai-11',
    'ajai-12',
    'ajai-13',
    'ajai-14',
    'ajai-15',
    'ajai-16',
    'ajai-17',
    'ajai-18',
    'ajai-19',
    'ajai-20',
    'ajai-21',
    'ajai-22',
    'ajai-23',
    'ajai-24',
    'ajai-25',
    'ajai-26',
    'ajai-27',
    'ajai-28',
    'ajai-29',
    'ajai-30',
    'ajai-31',
    'ajai-32',
    'ajai-33',
    'ajai-34',
    'ajai-35',
    'ajai-36',
    'ajai-37',
    'ajai-38',
    'ajai-39',
    'ajzs-01',
    'ajzs-02',
    'ajzs-03',
    'ajzs-04',
    'ajzs-05',
    'ajzs-06',
    'ajzs-07',
    'ajzs-08',
    'ajzs-09',
    'ajzs-10',
    'ajzs-11',
    'ajzs-12',
    'ajzs-13',
    'ajzs-14',
    'ajzs-15',
    'ajzs-16',
    'ajzs-17',
    'ajzs-18',
    'ajzs-19',
    'ajzs-20',
    'ajzs-21',
    'ajzs-22',
    'ajzs-23',
    'ajzs-24',
    'ajzs-25',
    'ajzs-26',
    'ajzs-27',
    'ajzs-28',
    'ajzs-29',
    'ajzs-30',
    'ajrp-01',
    'ajrp-02',
    'ajrp-03',
    'ajrp-04',
    'ajrp-05',
    'ajrp-06',
    'ajrp-07',
    'ajrp-08',
    'ajrp-09',
    'ajrp-10',
    'ajrp-11',
    'ajrp-12',
    'ajrp-13',
    'ajrp-14',
    'ajrp-15',
    'ajrp-16',
    'ajrp-17',
    'ajrp-18',
    'ajrp-19',
    'ajrp-20',
    'ajrp-21',
    'ajrp-22',
    'ajrp-23',
    'ajrp-24',
    'ajrp-25',
    'ajrp-26',
    'ajrp-27',
    'ajrp-28',
    'ajrp-29',
    'ajrp-30',
    'ajrp-31',
    'ajlr-01',
    'ajlr-02',
    'ajlr-03',
    'ajlr-04',
    'ajlr-05',
    'ajlr-06',
    'ajlr-07',
    'ajlr-08',
    'ajlr-09',
    'ajlr-10',
    'ajlr-11',
    'ajlr-12',
    'ajlr-13',
    'ajlr-14',
    'ajlr-15',
    'ajlr-16',
    'ajlr-17',
    'ajlr-18',
    'ajlr-19',
    'ajlr-20',
    'ajlr-21',
    'ajlr-22',
    'ajlr-23',
    'ajlr-24',
    'ajlr-25',
    'ajlr-26',
    'ajlr-27',
    'ajlr-28',
    'ajlr-29',
    'ajlr-30',
    'ajlr-31',
    'ajs-01',
    'ajs-02',
    'ajs-03',
    'ajs-04',
    'ajs-05',
    'ajs-06',
    'ajs-07',
    'ajs-08',
    'ajs-09',
    'ajs-10',
    'ajs-11',
    'ajs-12',
    'ajs-13',
    'ajs-14',
    'ajs-15',
    'ajs-16',
    'ajs-17',
    'ajs-18',
    'ajs-19',
    'ajs-20',
    'ajs-21',
    'ajs-22',
    'ajs-23',
    'ajs-24',
    'ajs-25',
    'ajs-26',
    'ajs-27',
    'ajs-28',
    'ajs-29',
    'ajs-30',
    'ajs-31',
    'ajs-32',
    'ajs-33',
    'ajbp-01',
    'ajbp-02',
    'ajbp-03',
    'ajbp-04',
    'ajbp-05',
    'ajbp-06',
    'ajbp-07',
    'ajbp-08',
    'ajbp-09',
    'ajbp-10',
    'ajbp-11',
    'ajbp-12',
    'ajbp-13',
    'ajbp-14',
    'ajbp-15',
    'ajbp-16',
    'ajbp-17',
    'ajbp-18',
    'ajbp-19',
    'ajbp-20',
    'ajbp-21',
    'ajbp-22',
    'ajbp-23',
    'ajbp-24',
    'ajbp-25',
    'ajbp-26',
    'ajbp-27',
    'ajbp-28',
    'ajbp-29',
    'ajbp-30',
    'ajpe-01',
    'ajpe-02',
    'ajpe-03',
    'ajpe-04',
    'ajpe-05',
    'ajpe-06',
    'ajpe-07',
    'ajpe-08',
    'ajpe-09',
    'ajpe-10',
    'ajpe-11',
    'ajpe-12',
    'ajpe-13',
    'ajpe-14',
    'ajpe-15',
    'ajpe-16',
    'ajpe-17',
    'ajpe-18',
    'ajpe-19',
    'ajpe-20',
    'ajpe-21',
    'ajpe-22',
    'ajpe-23',
    'ajpe-24',
    'ajpe-25',
    'ajpe-26',
    'ajpe-27',
    'ajpe-28',
    'ajpe-29',
    'ajpe-30',
    'ajpe-31',
    'ajpe-32',
    'ajpe-33',
    'ajpe-34',
    'ajpe-35',
    'ajpe-36',
    'ajpe-37',
    'ajpe-38',
    'ajpe-39',
    'ajpe-40',
    'ajpe-41',
    'ajpe-42',
    'ajpe-43',
    'ajpe-44',
    'ajpe-45',
    'ajpe-46',
    'ajpe-47',
    'ajpe-48',
    'ajkc-01',
    'ajkc-02',
    'ajkc-03',
    'ajkc-04',
    'ajkc-05',
    'ajkc-06',
    'ajkc-07',
    'ajkc-08',
    'ajkc-09',
    'ajkc-10',
    'ajkc-11',
    'ajkc-12',
    'ajkc-13',
    'ajkc-14',
    'ajzb-01',
    'ajzb-02',
    'ajzb-03',
    'ajzb-04',
    'ajzb-05',
    'ajzb-06',
    'ajzb-07',
    'ajzb-08',
    'ajzb-09',
    'ajzb-10',
    'ajzb-11',
    'ajzb-12',
    'ajzb-13',
    'ajzb-14',
    'ajzb-15',
    'ajzb-16',
    'ajzb-17',
    'ajzb-18',
    'ajzb-19',
    'ajzb-20',
    'ajzb-21',
    'ajzb-22',
    'ajzb-23',
    'ajzb-24',
    'ajzb-25',
    'ajwe-01',
    'ajwe-02',
    'ajwe-03',
    'ajwe-04',
    'ajwe-05',
    'ajwe-06',
    'ajwe-07',
    'ajwe-08',
    'ajwe-09',
    'ajwe-10',
    'ajwe-11',
    'ajwe-12',
    'ajwe-13',
    'ajwe-14',
    'ajwe-15',
    'ajwe-16',
    'ajwe-17',
    'ajwe-18',
    'ajwe-19',
    'ajwe-20',
    'ajae-01',
    'ajae-02',
    'ajae-03',
    'ajae-04',
    'ajae-05',
    'ajae-06',
    'ajae-07',
    'ajae-08',
    'ajae-09',
    'ajae-10',
    'ajim-01',
    'ajim-02',
    'ajim-03',
    'ajim-04',
    'ajim-05',
    'ajim-06',
    'ajim-07',
    'ajim-08',
    'ajim-09',
    'ajim-10',
    'ajim-11',
    'ajim-12',
    'ajim-13',
    'ajim-14',
    'ajim-15',
    'ajim-16',
    'ajim-17',
    'ajim-18',
    'ajim-19',
    'ajst-01',
    'ajst-02',
    'ajst-03',
    'ajst-04',
    'ajst-05',
    'ajst-06',
    'ajst-07',
    'ajst-08',
    'ajst-09',
    'ajst-10',
    'ajst-11',
    'ajst-12',
    'ajst-13',
    'ajst-14',
    'ajst-15',
    'ajst-16',
    'ajle-01',
    'ajle-02',
    'ajle-03',
    'ajle-04',
    'ajle-05',
    'ajle-06',
    'ajle-07',
    'ajle-08',
    'ajle-09',
    'ajle-10',
    'ajle-11',
    'ajle-12',
    'ajle-13',
    'ajle-14',
    'ajle-15',
    'ajle-16',
    'ajle-17',
    'ajle-18',
    'ajle-19',
    'ajle-20',
    'ajle-21',
    'ajle-22',
    'ajle-23',
    'ajmc-01',
    'ajmc-02',
    'ajmc-03',
    'ajmc-04',
    'ajmc-05',
    'ajmc-06',
    'ajmc-07',
    'ajmc-08',
    'ajmc-09',
    'ajmc-10',
    'ajp-01',
    'ajp-02',
    'ajp-03',
    'ajp-04',
    'ajp-05',
    'ajp-06',
    'ajp-07',
    'ajp-08',
    'ajp-09',
    'ajp-10',
    'ajp-11',
    'ajp-12',
    'ajp-13',
    'ajp-14',
    'ajp-15',
    'ajsm-01',
    'ajsm-02',
    'ajsm-03',
    'ajsm-04',
    'ajsm-05',
    'ajsm-06',
    'ajsm-07',
    'ajsm-08',
    'ajsm-09',
    'ajsm-10',
    'ajsm-11',
    'ajsm-12',
    'ajsm-13',
    'ajsm-14',
    'ajsm-15',
    'ajsm-16',
    'ajsm-17',
    'ajsm-18',
    'ajsm-19',
    'ajsm-20',
    'ajsm-21',
    'ajsm-22',
    'ajsm-23',
    'ajsm-24',
    'ajsm-25',
    'ajsm-26',
    'ajsm-27',
    'ajsm-28',
    'ajsm-29',
    'ajsm-30',
    'ajsm-31',
    'ajsm-32',
    'ajsm-33',
    'ajsm-34',
    'ajsm-35',
    'ajsm-36',
    'ajsm-37',
    'ajsm-38',
    'ajsm-39',
    'ajsm-40',
    'ajsm-41',
    'ajsm-42',
    'ajsm-43',
    'ajsm-44',
    'ajsm-45',
    'ajsm-46',
    'ajsm-47',
    'ajtf-01',
    'ajtf-02',
    'ajtf-03',
    'ajtf-04',
    'ajtf-05',
    'ajtf-06',
    'ajtf-07',
    'ajtf-08',
    'ajtf-09',
    'ajtf-10',
    'ajpr-01',
    'ajpr-02',
    'ajpr-03',
    'ajpr-04',
    'ajpr-05',
    'ajpr-06',
    'ajpr-07',
    'ajck-01',
    'ajck-02',
    'ajck-03',
    'ajck-04',
    'ajck-05',
    'ajck-06',
    'ajck-07',
    'ajck-08',
    'ajck-09',
    'ajck-10',
    'ajck-11',
    'ajsl-01',
    'ajsl-02',
    'ajsl-03',
    'ajsl-04',
    'ajsl-05',
    'ajsl-06',
    'ajsl-07',
    'ajsl-08',
    'ajsl-09',
    'ajsl-10',
    'ajsl-11',
    'ajsl-12',
    'ajsl-13',
    'ajsl-14',
    'ajsl-15',
    'ajsl-16',
    'ajsl-17',
    'ajsl-18',
    'ajsl-19',
    'ajrl-01',
    'ajrl-02',
    'ajrl-03',
    'ajrl-04',
    'ajrl-05',
    'ajrl-06',
    'ajrl-07',
    'ajrl-08',
    'ajrl-09',
    'ajrl-10',
    'ajrl-11',
    'ajrl-12',
    'ajrl-13',
    'ajrl-14',
    'ajrl-15',
    'ajrl-16',
    'ajrl-17',
    'ajrl-18',
    'ajrl-19',
    'ajrl-20',
  ];

  const quantities = [
    5, 10, 15, 20, 25, 28, 30, 31, 56, 89, 100, 200, 215, 223, 241, 243, 245,
    248, 250,
  ];

  for (const slug of slugs) {
    try {
      const { data } = await axios.get(
        `https://asimjofa.com/products/${slug}.js`,
      );

      const vendorId = await handleVendor(data.vendor, data.featured_image);

      const product = await prisma.product.findUnique({
        where: { title: data.title },
      });

      if (product) continue;

      const quantity = data.available
        ? quantities[Math.floor(Math.random() * quantities.length)]
        : 0;

      const hasDiscount = Math.random() >= 0.5;

      await prisma.product.create({
        data: {
          inStock: data.available,
          vendorId,
          price: Math.round(data.price / 10),
          slug: data.handle,
          title: data.title,
          description: data.description,
          images: data.images,
          hasDiscount,
          discountPercent: hasDiscount ? new Prisma.Decimal(10) : 0,
          publishedAt: data.published_at,
          tags: data.tags,
          type: data.type,
          quantity,
          isPopular: Math.random() >= 0.5,
          sizes: getRandomProductSize(),
        },
      });
    } catch (error) {
      console.log(`No product found with slug = ${slug}`);
      continue;
    }
  }
}

main()
  .then(async () => {
    await prisma.$disconnect();
  })
  .catch(async (e) => {
    console.error(e);
    await prisma.$disconnect();
    process.exit(1);
  });
